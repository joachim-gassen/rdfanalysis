<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rdfanalysis">
<title>Analyzing Researcher Degrees of Freedom: A Case Study • rdfanalysis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing Researcher Degrees of Freedom: A Case Study">
<meta property="og:description" content="rdfanalysis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119053376-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-119053376-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rdfanalysis</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analyzing_rdf.html">Analyzing Researcher Degrees of Freedom: A Case Study</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.github.com/joachim-gassen/rdfanalysis">
    <span class="fa fa-github"></span>
     
    Code repository
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="analyzing_rdf_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="analyzing_rdf_files/viz-1.8.2/viz.js"></script><link href="analyzing_rdf_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="analyzing_rdf_files/grViz-binding-1.0.9/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analyzing Researcher Degrees of Freedom: A Case Study</h1>
                        <h4 data-toc-skip class="author">Joachim
Gassen</h4>
            
            <h4 data-toc-skip class="date">2023-02-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/joachim-gassen/rdfanalysis/blob/HEAD/vignettes/analyzing_rdf.Rmd" class="external-link"><code>vignettes/analyzing_rdf.Rmd</code></a></small>
      <div class="d-none name"><code>analyzing_rdf.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The idea of the in-development <code>rdfanalysis</code> package is to
provide a coding environment that allows researchers to systematically
document and analyze the degrees of freedom in their research designs.
The notion “researcher degrees of freedom” has been introduced by <a href="https://journals.sagepub.com/doi/pdf/10.1177/0956797611417632" class="external-link">Simmons
et al., (Psyc Science, 2011)</a>. In their own words (p. 1359):</p>
<blockquote>
<p>The culprit is a construct we refer to as <em>researcher degrees of
freedom</em>. In the course of collecting and analyzing data,
researchers have many decisions to make: Should more data be collected?
Should some observations be excluded? Which conditions should be
combined and which ones compared? Which control variables should be
considered? Should specific measures be combined or transformed or
both?</p>
</blockquote>
<p>This vignette will use a case to guide you through the process of how
to use the package for an analysis that makes its inherent researcher
degrees of freedom transparent. The outcome of this activity will be
similar to the multiverse analysis approach suggested by <a href="https://journals.sagepub.com/doi/abs/10.1177/1745691616658637" class="external-link">Steeger
et al. (Persp on Psych Sci 2016)</a>.</p>
</div>
<div class="section level2">
<h2 id="the-case">The Case<a class="anchor" aria-label="anchor" href="#the-case"></a>
</h2>
<p>As case we assess the impact of real Gross Domestic Product (GDP) per
capita on life expectancy. This association has become known as the <a href="https://en.wikipedia.org/wiki/Preston_curve" class="external-link">Preston Curve</a> (<a href="https://www.tandfonline.com/doi/abs/10.1080/00324728.1975.10410201" class="external-link">Preston,
Pop Studies, 1975</a>).</p>
<center>
<div class="figure">
<img src="preston_1975_p235.png" style="width:7in" alt=""><p class="caption">Preston (1975): The Changing Relation between
Mortality and level of Economic Development, Population Studies (29):
235.</p>
</div>
</center>
<p>We will estimate the respective coefficient for GDP per capita in a
multiple regression framework on a panel data set of country-year data
provided by the <a href="https://data.worldbank.org" class="external-link">World Bank</a> (GDP
per capita, life expectancy at birth and unemployment rates), and the <a href="http://dataexplorer.wittgensteincentre.org/wcde-v2/" class="external-link">Wittgenstein
Center</a> for mean years of schooling received by country inhabitants
being 15 years or older. As the schooling data is available at 5 year
intervals only, I interpolate the years in-between linearly to keep the
data at annual frequency (another research degree of freedom, I know …).
If you want to explore the data underlying the case, <a href="https://jgassen.shinyapps.io/expand_rdfanalysis" class="external-link">click here</a> to
access an interactive data exploration tool based on my <a href="https://joachim-gassen.github.io/ExPanDaR" class="external-link">ExPanDaR package</a>.
With this tool, you can also re-generate most protocols that we study
below by hand.</p>
<p>While the analysis it not meant to contribute to the question whether
there is a causal link between GDP per capita and life expectancy (see
<a href="https://doi.org/10.1111/padr.12141" class="external-link">Lutz and Kebede, Pop and
Dev Review 2018</a> for a recent discussion), I design the analysis such
that identifying assumptions for such a causal interpretation of its
findings are explicit.</p>
</div>
<div class="section level2">
<h2 id="step-1-define-research-design-by-a-series-of-functions">Step 1: Define research design by a series of functions<a class="anchor" aria-label="anchor" href="#step-1-define-research-design-by-a-series-of-functions"></a>
</h2>
<p>Every research design can be implemented as a series of functions
where each function receives the output of the previous function as a
parameter and produces output for the next function.</p>
<p>In the terminology of the <code>rdfanalysis</code> package, each
function is called a “design step”. It comes with “choices” that can be
either discrete or continuous in nature. The choices are what generate
researcher degrees of freedom. A set of made choices across all steps of
a design constitutes a “research protocol”. The total number of feasible
research protocols equals the researcher degrees of freedom of a
research design.</p>
<p>In our case and in most designs, the first step reads or generates
data, and the last step generates results. In principle, the
<code>rdfanalysis</code> package is agnostic about the data structure
that constitutes a result. In most cases, the result will take the form
of one or several confidence intervals. In our case, it is the 95 %
confidence interval for the effect of a 10 % GDP per capita increase on
life expectancy in years, provided by three variables:</p>
<ul>
<li>the estimate (<code>est</code>)</li>
<li>a lower bound (<code>lb</code>) and</li>
<li>an upper bound (<code>ub</code>).</li>
</ul>
<p>To assess the impact of GDP per capita on life expectancy, our case
design follows the following steps</p>
<ul>
<li>Read data</li>
<li>Select independent variables for model</li>
<li>Treat extreme observations</li>
<li>Specify model</li>
<li>Estimate model</li>
</ul>
<p>Each step will be implemented by a function. To set up such a
functional structure, you use the command <code><a href="../reference/define_design.html">define_design()</a></code>.
This function creates a series of function templates in a directory of
your choice. Existing files are not over-written. You can choose whether
you want your functions all in one R file or whether you want to
generate separate files. I am going with separate files here.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joachim-gassen.github.io/rdfanalysis" class="external-link">rdfanalysis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joachim-gassen.github.io/ExPanDaR/" class="external-link">ExPanDaR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_design.html">define_design</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"read_data"</span>, </span>
<span>                                  <span class="st">"select_idvs"</span>, </span>
<span>                                  <span class="st">"treat_extreme_obs"</span>, </span>
<span>                                  <span class="st">"specify_model"</span>, </span>
<span>                                  <span class="st">"est_model"</span><span class="op">)</span>,</span>
<span>                        rel_dir <span class="op">=</span> <span class="st">"case_study_code"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-2-implement-design-steps">Step 2: Implement design steps<a class="anchor" aria-label="anchor" href="#step-2-implement-design-steps"></a>
</h2>
<p>When you take a look at the newly created directory, you will see a
set of R files. Each file contains a template like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">choice</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># This is a template for a design step</span></span>
<span>  <span class="co"># to be used by the rdfanalysis package</span></span>
<span>  <span class="co"># See https://joachim-gassen.github.io/rdfanalysis</span></span>
<span>  <span class="co"># for further information on how to use this template</span></span>
<span>  <span class="co"># and the package.</span></span>
<span></span>
<span>  <span class="co"># Feel free to delete any/all lines containing comments but leave</span></span>
<span>  <span class="co"># the line containing ("Analysis code starts below") unchanged.</span></span>
<span></span>
<span>  <span class="co"># Provide your documentation in the two variables below.</span></span>
<span>  <span class="co"># They will be used by prepare_design_documentation()</span></span>
<span></span>
<span>  <span class="va">step_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"## [Step Title]"</span>,</span>
<span>    <span class="st">"### Content"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"[Explain what the step does]"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"### Choice"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"`[name of discrete choice]`: A character value containing one of the"</span>,</span>
<span>    <span class="st">"following values:"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"- `[valid_value 1]`: [What this choice does]"</span>,</span>
<span>    <span class="st">"- `[valid_value n]`: [What that choice does]"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"`[name of continuous choice]`: [Explain valid range for continuous choice"</span>,</span>
<span>    <span class="st">"and what it does]"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Specify your valid choices below. Format will be checked by test_design()</span></span>
<span>  <span class="co"># for consistency</span></span>
<span></span>
<span>  <span class="va">choice_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"[name of discrete choice]"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"character"</span>,</span>
<span>         valid_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[valid_value 1]"</span>, <span class="st">"[valid_value n]"</span><span class="op">)</span>,</span>
<span>         <span class="co"># weights are not required but they need to add up to one if</span></span>
<span>         <span class="co"># they are provided. Adjust the example below</span></span>
<span>         weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"[name of continuous choice]"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"double"</span>,</span>
<span>         valid_min <span class="op">=</span> <span class="fl">0</span>, valid_max <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>         <span class="co"># weights for continuous choices are provided by a sample of choices.</span></span>
<span>         <span class="co"># Could be just one value. Adjust the example below</span></span>
<span>         weight_sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># You should not need to change anything in the following code section</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    step_description <span class="op">=</span> <span class="va">step_description</span>,</span>
<span>    choice_description <span class="op">=</span> <span class="va">choice_description</span>,</span>
<span>    choice_type <span class="op">=</span> <span class="va">choice_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/check_choice.html">check_choice</a></span><span class="op">(</span><span class="va">choice</span>, <span class="va">choice_type</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Leave the following comment untouched. It is being used by</span></span>
<span>  <span class="co"># prepare_design_documentation() to identify the part of the step</span></span>
<span>  <span class="co"># that should be included in the documentation.</span></span>
<span></span>
<span>  <span class="co"># ___ Analysis code starts below ___</span></span>
<span></span>
<span>  <span class="co"># Here you need to add your code.</span></span>
<span></span>
<span>  <span class="co"># If this is the first step of your design, you can access input data via the</span></span>
<span>  <span class="co"># input parameter. If it is a subsequent step, you can access input data</span></span>
<span>  <span class="co"># via input$data and the protocol leading to this step by input$protocol.</span></span>
<span></span>
<span>  <span class="co"># Make sure that you address all choices identified above.</span></span>
<span></span>
<span>  <span class="co"># In the return block below, you need to replace the placeholder with the</span></span>
<span>  <span class="co"># variable that contains the data that you want to return as output</span></span>
<span>  <span class="co"># to the next step or as a result if this is the last step.</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="st">"[variable containing your output data structure here]"</span>,</span>
<span>    protocol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The task is now to implement the code for each step. To do so, you
should first set <code>step_description</code> and
<code>choice_description</code>. Each variable takes a vector of strings
that will be concatenated to R Markdown code to provide the code
documentation (see <code><a href="../reference/prepare_design_documentation.html">prepare_design_documentation()</a></code> below).
Use these variables to explain what the step does and which choices it
contains.</p>
<p>Let’s apply this to our first design step <code>read_data()</code>.
When we import the raw data, we can decide whether we require each
country-year observation to have non-missing data for all potential
variables. To implement this discrete choice, you document it in
<code>choice_description</code> and specify it in
<code>choice_type</code>. The <code>weight</code> parameter can be used
to provide the choice (or weighting of choices) that you <em>a
priori</em> assume to be supported by theory. The final function
<code>read_data()</code> is provided below. It simply reads a CSV file
containing data, limits the sample to the required variables and deletes
cases with missing data if the choice <code>na.omit</code> is set to
<code>"yes"</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">choice</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">step_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"## Read data"</span>,</span>
<span>    <span class="st">"### Content"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"Reads country year world bank data CSV file and generates raw sample"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"### Choice"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"`na.omit`: A character value containing one of the"</span>,</span>
<span>    <span class="st">"following values:"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"- `yes`: All observations with missing data are excluded"</span>,</span>
<span>    <span class="st">"- `no`: All observations with missing data are included"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">choice_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"na.omit"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"character"</span>,</span>
<span>         valid_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span>,</span>
<span>         weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    step_description <span class="op">=</span> <span class="va">step_description</span>,</span>
<span>    choice_description <span class="op">=</span> <span class="va">choice_description</span>,</span>
<span>    choice_type <span class="op">=</span> <span class="va">choice_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/check_choice.html">check_choice</a></span><span class="op">(</span><span class="va">choice</span>, <span class="va">choice_type</span><span class="op">)</span></span>
<span>  <span class="co"># ___ Analysis code starts below ___</span></span>
<span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">input</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>,</span>
<span>           <span class="va">lifeexpectancy</span>, <span class="va">gdp_capita</span>,</span>
<span>           <span class="va">mn_yrs_school</span>, <span class="va">unemployment</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">choice</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span> <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    protocol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For the other steps you follow the same approach. For our case study,
I implement the following choices:</p>
<ul>
<li>
<code>select_idvs()</code>: selects the independent variables that
we want to include in our regression model. <code>idvs</code> names
these variables.</li>
<li>
<code>treat_extreme_obs()</code>: treats extreme observations that
otherwise tend to be highly influential for regression outcomes.
<code>outlier_tment_style</code> indicates whether you want to use
truncating or winsorizing. <code>outlier_cutoff</code> holds the
percentile cutoff. It can be within the range [0, 0.1] (0 to 10 %, with
0 indicating no outlier treatment).</li>
<li>
<code>specify_model()</code>: provides the specification of the
regression model. <code>model_type</code> determines whether the model
will be estimated as level-level, log-level, level-log or log-log
specification.</li>
<li>
<code>est_model()</code>: estimates the main effect of interest. To
make the estimates comparable across different model specifications
model coefficients are transformed so that each estimates the life
expectancy effect in years of a 10 % increase in GDP per capita. The
choice <code>feffects</code> determines which fixed effects are used
(none, country, year or both) and <code>cluster</code> indicates how the
standard errors should be clustered (not, by country, by year, or
two-way by country and year).</li>
</ul>
<p>All these choices are rather standard choices in research designs
based on observational data. Taken together and assuming that you want
to generate outlier cases for each percentile from 0 to 10, they
generate <span class="math inline">\(2 * 4 * 2 * 11 * 4 * 4 * 4 =
11,264\)</span> researcher degrees of freedom!</p>
<p>Below you find all four functions. Copy and paste them into the
template files to generate your research design.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">select_idvs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">choice</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">step_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"## Identify the variables for analysis"</span>,</span>
<span>    <span class="st">"### Content"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"Select the variables that you want to use in the regression analysis."</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"### Choice"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"`idvs`: A character value containing one of the"</span>,</span>
<span>    <span class="st">"following values:"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"- `gdp_only`: GDP per capita only"</span>,</span>
<span>    <span class="st">"- `gdp_school`: GDP per capita and mean years schooling"</span>,</span>
<span>    <span class="st">"- `gdp_ue`: GDP per capita and unemployment"</span>,</span>
<span>    <span class="st">"- `full`: Full model including all three variables"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"idvs"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"character"</span>,</span>
<span>         valid_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gdp_only"</span>, <span class="st">"gdp_school"</span>, <span class="st">"gdp_ue"</span>, <span class="st">"full"</span><span class="op">)</span>,</span>
<span>         weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    step_description <span class="op">=</span> <span class="va">step_description</span>,</span>
<span>    choice_description <span class="op">=</span> <span class="va">choice_description</span>,</span>
<span>    choice_type <span class="op">=</span> <span class="va">choice_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/check_choice.html">check_choice</a></span><span class="op">(</span><span class="va">choice</span>, <span class="va">choice_type</span><span class="op">)</span></span>
<span>  <span class="co"># ___ Analysis code starts below ___</span></span>
<span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                <span class="st">"gdp_only"</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">mn_yrs_school</span>, <span class="op">-</span><span class="va">unemployment</span><span class="op">)</span>,</span>
<span>                <span class="st">"gdp_school"</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">unemployment</span><span class="op">)</span>,</span>
<span>                <span class="st">"gdp_ue"</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">mn_yrs_school</span><span class="op">)</span>,</span>
<span>                <span class="st">"full"</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">protocol</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">protocol</span></span>
<span>  <span class="va">protocol</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">protocol</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">choice</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    protocol <span class="op">=</span> <span class="va">protocol</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">treat_extreme_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">choice</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">step_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"## Select the type of outlier treatment"</span>,</span>
<span>    <span class="st">"### Content"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"Select how you want to treat extreme observations. They can be winsorized or truncated"</span>,</span>
<span>    <span class="st">"to a given percentile of the data."</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"### Choice"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"A list containing a character value `outlier_tment_style` and a numerical value `outlier_cutoff`."</span>,</span>
<span>    <span class="st">"`outlier_tment_style` may take one of the following values:"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"- `win`: Winsorization"</span>,</span>
<span>    <span class="st">"- `trunc`: Truncation"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"`outlier_cutoff` sets the cut-off percentile for the outlier treatment"</span>,</span>
<span>    <span class="st">"and may take any value within [0, 0.10]"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"outlier_tment_style"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"character"</span>,</span>
<span>         valid_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"win"</span>, <span class="st">"trunc"</span><span class="op">)</span>,</span>
<span>         weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"outlier_cutoff"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"double"</span>,</span>
<span>         valid_min <span class="op">=</span> <span class="fl">0</span>, valid_max <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>         weight_sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    step_description <span class="op">=</span> <span class="va">step_description</span>,</span>
<span>    choice_description <span class="op">=</span> <span class="va">choice_description</span>,</span>
<span>    choice_type <span class="op">=</span> <span class="va">choice_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/check_choice.html">check_choice</a></span><span class="op">(</span><span class="va">choice</span>, <span class="va">choice_type</span><span class="op">)</span></span>
<span>  <span class="co"># ___ Analysis code starts below ___</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">protocol</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">protocol</span></span>
<span>    <span class="va">protocol</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">protocol</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">choice</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span>,</span>
<span>      protocol <span class="op">=</span> <span class="va">protocol</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>         <span class="st">"win"</span> <span class="op">=</span> <span class="op">{</span></span>
<span>           <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span></span>
<span>           <span class="va">df</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>             <span class="fu"><a href="https://joachim-gassen.github.io/ExPanDaR/reference/treat_outliers.html" class="external-link">treat_outliers</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span>, percentile <span class="op">=</span> <span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>           <span class="va">df</span></span>
<span>         <span class="op">}</span>,</span>
<span>         <span class="st">"trunc"</span> <span class="op">=</span> <span class="op">{</span></span>
<span>           <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span></span>
<span>           <span class="va">df</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>             <span class="fu"><a href="https://joachim-gassen.github.io/ExPanDaR/reference/treat_outliers.html" class="external-link">treat_outliers</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                            percentile <span class="op">=</span> <span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                            truncate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>           <span class="va">df</span></span>
<span>         <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">protocol</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">protocol</span></span>
<span>  <span class="va">protocol</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">protocol</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">choice</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    protocol <span class="op">=</span> <span class="va">protocol</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">specify_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">choice</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">step_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"## Specify the model type to be estimated"</span>,</span>
<span>    <span class="st">"### Content"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"Specify whether you want to estimate a level model or whether you"</span>,</span>
<span>    <span class="st">"want to use log tansformed dependent and/or independent variables."</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"### Choice"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"`model_type`: A character value containing one of the"</span>,</span>
<span>    <span class="st">"following values:"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"- `level-level`: Use untransformed dependent and independent variables"</span>,</span>
<span>    <span class="st">"- `log-level`: Use log-transformed dependent and"</span>,</span>
<span>    <span class="st">"untransformed independent variables"</span>,</span>
<span>    <span class="st">"- `level-log`: Use untransformed dependent and"</span>,</span>
<span>    <span class="st">"log-transformed independent variables"</span>,</span>
<span>    <span class="st">"- `log-log`: Use log-transformed dependent and independent variables"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"model_type"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"character"</span>,</span>
<span>         valid_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"level-level"</span>, <span class="st">"log-level"</span>,</span>
<span>                          <span class="st">"level-log"</span>, <span class="st">"log-log"</span><span class="op">)</span>,</span>
<span>         weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    step_description <span class="op">=</span> <span class="va">step_description</span>,</span>
<span>    choice_description <span class="op">=</span> <span class="va">choice_description</span>,</span>
<span>    choice_type <span class="op">=</span> <span class="va">choice_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/check_choice.html">check_choice</a></span><span class="op">(</span><span class="va">choice</span>, <span class="va">choice_type</span><span class="op">)</span></span>
<span>  <span class="co"># ___ Analysis code starts below ___</span></span>
<span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span> <span class="op">==</span> <span class="st">"log-level"</span> <span class="op">|</span> <span class="va">choice</span> <span class="op">==</span> <span class="st">"log-log"</span><span class="op">)</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">lifeexpectancy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lifeexpectancy</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span> <span class="op">==</span> <span class="st">"level-log"</span> <span class="op">|</span> <span class="va">choice</span> <span class="op">==</span> <span class="st">"log-log"</span><span class="op">)</span></span>
<span>    <span class="va">df</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">protocol</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">protocol</span></span>
<span>  <span class="va">protocol</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">protocol</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">choice</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    protocol <span class="op">=</span> <span class="va">protocol</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">est_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">choice</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">step_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"## Estimates the model"</span>,</span>
<span>    <span class="st">"### Content"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"Uses a multiple regression setup to generate an estimate and"</span>,</span>
<span>    <span class="st">"a confidence interval for the effect of a 10 % increase in GDP per capita"</span>,</span>
<span>    <span class="st">"on life expectancy in years."</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"### Choice"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"A list containing two character values: `cluster` and `feffect`."</span>,</span>
<span>    <span class="st">"`cluster` defines the clustering of standard errors and"</span>,</span>
<span>    <span class="st">"`feffect` defines the fixed effect structure of the model."</span>,</span>
<span>    <span class="st">"Each value may take one of the following values:"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="st">"- `none`, `ctry`, `year` or `ctryyear`"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">choice_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"feffect"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"character"</span>,</span>
<span>         valid_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"ctryyear"</span><span class="op">)</span>,</span>
<span>         weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"cluster"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"character"</span>,</span>
<span>         valid_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"ctryyear"</span><span class="op">)</span>,</span>
<span>         weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    step_description <span class="op">=</span> <span class="va">step_description</span>,</span>
<span>    choice_description <span class="op">=</span> <span class="va">choice_description</span>,</span>
<span>    choice_type <span class="op">=</span> <span class="va">choice_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="../reference/check_choice.html">check_choice</a></span><span class="op">(</span><span class="va">choice</span>, <span class="va">choice_type</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ___ Analysis code starts below ___</span></span>
<span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lifeexpectancy ~ "</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"country"</span> <span class="op">||</span> <span class="va">choice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"year"</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">f</span>, <span class="st">"| "</span>, <span class="va">choice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"ctryyear"</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">f</span>, <span class="st">" | country + year"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span> <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">f</span>, <span class="st">" | 0 "</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"country"</span> <span class="op">||</span> <span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"year"</span><span class="op">)</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">f</span>, <span class="st">"| 0 | "</span>, <span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">f</span>, <span class="st">"| 0 | country + year "</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">choice</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"none"</span><span class="op">)</span> <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">lfe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span><span class="va">form</span>, <span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">protocol</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">protocol</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">protocol</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"level-level"</span><span class="op">)</span></span>
<span>    <span class="va">mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">gdp_capita</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">protocol</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"level-log"</span><span class="op">)</span></span>
<span>    <span class="va">mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">protocol</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"log-level"</span><span class="op">)</span></span>
<span>    <span class="va">mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">gdp_capita</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">lifeexpectancy</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="va">mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">lifeexpectancy</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    est <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span> <span class="op">==</span> <span class="st">'gdp_capita'</span><span class="op">]</span> <span class="op">*</span> <span class="va">mult</span>,</span>
<span>    lb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span> <span class="op">==</span> <span class="st">'gdp_capita'</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">mult</span>,</span>
<span>    ub <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span> <span class="op">==</span> <span class="st">'gdp_capita'</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">mult</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">protocol</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">protocol</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">choice</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">l</span>,</span>
<span>    protocol <span class="op">=</span> <span class="va">protocol</span>,</span>
<span>    model <span class="op">=</span> <span class="va">mod</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-3-source-test-and-document-design">Step 3: Source, test and document design<a class="anchor" aria-label="anchor" href="#step-3-source-test-and-document-design"></a>
</h2>
<p>After implementing the design, you need to source it. In addition,
you can test the design code for input parameter consistency at this
stage. This test will verify that each step provides a step description,
a choice description and the valid choice types to the user when called
without input parameter. If weights are provided, the test verifies that
the weights add up to one and are within the valid choice range.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/source_design.html">source_design</a></span><span class="op">(</span><span class="va">design</span>, rel_dir <span class="op">=</span> <span class="st">"case_study_code"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/test_design.html">test_design</a></span><span class="op">(</span><span class="va">design</span>, reporter <span class="op">=</span> <span class="st">"minimal"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">...............................................................................................................................................</span></span></span></code></pre></div>
<p>The test does not complain. Next, the command
<code><a href="../reference/prepare_design_documentation.html">prepare_design_documentation()</a></code> produces a PDF document
based on the <code>step_description</code> and
<code>choice_description</code> that you provided for each step. By
default, it also includes the “pay load” code for each design step.</p>
<p>In addition, the command <code><a href="../reference/prepare_design_flow_chart.html">prepare_design_flow_chart()</a></code>
produces a visualization of your design steps and of their choices.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prepare_design_documentation.html">prepare_design_documentation</a></span><span class="op">(</span><span class="va">design</span>, <span class="st">"preston_curve_design.pdf"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prepare_design_flow_chart.html">prepare_design_flow_chart</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-307f2e17466358a46d13" style="width:768px;height:1152px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-307f2e17466358a46d13">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"white\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"read_data\", shape = \"rectangle\", fixedsize = \"FALSE\", fillcolor = \"#7EC0EE\", fontcolor = \"#FFFFFF\"] \n  \"2\" [label = \"na.omit:\nyes\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"3\" [label = \"na.omit:\nno\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"4\" [label = \"select_idvs\", shape = \"rectangle\", fixedsize = \"FALSE\", fillcolor = \"#7EC0EE\", fontcolor = \"#FFFFFF\"] \n  \"5\" [label = \"idvs:\ngdp_only\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"6\" [label = \"idvs:\ngdp_school\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"7\" [label = \"idvs:\ngdp_ue\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"8\" [label = \"idvs:\nfull\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"9\" [label = \"treat_extreme_obs\", shape = \"rectangle\", fixedsize = \"FALSE\", fillcolor = \"#7EC0EE\", fontcolor = \"#FFFFFF\"] \n  \"10\" [label = \"outlier_tment_style:\nwin\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"11\" [label = \"outlier_tment_style:\ntrunc\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"12\" [label = \"outlier_cutoff\nvalid_min: 0\nvalid_max: 0.1\", shape = \"oval\", fixedsize = \"FALSE\", fillcolor = \"#4A708B\", fontcolor = \"#FFFFFF\"] \n  \"13\" [label = \"specify_model\", shape = \"rectangle\", fixedsize = \"FALSE\", fillcolor = \"#7EC0EE\", fontcolor = \"#FFFFFF\"] \n  \"14\" [label = \"model_type:\nlevel-level\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"15\" [label = \"model_type:\nlog-level\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"16\" [label = \"model_type:\nlevel-log\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"17\" [label = \"model_type:\nlog-log\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"18\" [label = \"est_model\", shape = \"rectangle\", fixedsize = \"FALSE\", fillcolor = \"#7EC0EE\", fontcolor = \"#FFFFFF\"] \n  \"19\" [label = \"feffect:\nnone\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"20\" [label = \"feffect:\ncountry\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"21\" [label = \"feffect:\nyear\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"22\" [label = \"feffect:\nctryyear\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"23\" [label = \"cluster:\nnone\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"24\" [label = \"cluster:\ncountry\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"25\" [label = \"cluster:\nyear\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"26\" [label = \"cluster:\nctryyear\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#6CA6CD\", fontcolor = \"#FFFFFF\"] \n  \"27\" [label = \"result\", shape = \"diamond\", fixedsize = \"FALSE\", fillcolor = \"#708090\", fontcolor = \"#FFFFFF\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n  \"2\"->\"4\" \n  \"3\"->\"4\" \n  \"4\"->\"5\" \n  \"4\"->\"6\" \n  \"4\"->\"7\" \n  \"4\"->\"8\" \n  \"5\"->\"9\" \n  \"6\"->\"9\" \n  \"7\"->\"9\" \n  \"8\"->\"9\" \n  \"9\"->\"10\" \n  \"9\"->\"11\" \n  \"10\"->\"12\" \n  \"11\"->\"12\" \n  \"12\"->\"13\" \n  \"13\"->\"14\" \n  \"13\"->\"15\" \n  \"13\"->\"16\" \n  \"13\"->\"17\" \n  \"14\"->\"18\" \n  \"15\"->\"18\" \n  \"16\"->\"18\" \n  \"17\"->\"18\" \n  \"18\"->\"19\" \n  \"18\"->\"20\" \n  \"18\"->\"21\" \n  \"18\"->\"22\" \n  \"19\"->\"23\" \n  \"19\"->\"24\" \n  \"19\"->\"25\" \n  \"19\"->\"26\" \n  \"20\"->\"23\" \n  \"20\"->\"24\" \n  \"20\"->\"25\" \n  \"20\"->\"26\" \n  \"21\"->\"23\" \n  \"21\"->\"24\" \n  \"21\"->\"25\" \n  \"21\"->\"26\" \n  \"22\"->\"23\" \n  \"22\"->\"24\" \n  \"22\"->\"25\" \n  \"22\"->\"26\" \n  \"23\"->\"27\" \n  \"24\"->\"27\" \n  \"25\"->\"27\" \n  \"26\"->\"27\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="step-4-optional-but-encouraged-simulate-data-for-additional-testing-and-power-analysis">Step 4 (optional but encouraged): Simulate data for additional
testing and power analysis<a class="anchor" aria-label="anchor" href="#step-4-optional-but-encouraged-simulate-data-for-additional-testing-and-power-analysis"></a>
</h2>
<p>While not strictly necessary, a very useful next step is to simulate
your raw data. Simulating your data early in the project can be very
helpful for various reasons:</p>
<ul>
<li>It allows you to test your design steps without requiring you to
work with your real data, which would strictly speaking constitute a
breach of the “don’t mix exploration with inference” rule.</li>
<li>You can simulate your expected effect and verify that your design
identifies it correctly.</li>
<li>You can assess the power of your design.</li>
</ul>
<p>To demonstrate these steps, I use a very quick’n’dirty simulation
approach. It creates a country year panel and simulates data that are
roughly comparable to real data. It uses the following level-log
setup:</p>
<p><span class="math inline">\(lifeexpectancy = \beta_0 +
\frac{es}{\log(1.1)}\log(gdp\_capita) + 10\log(mn\_yrs\_school) +
5log(unemployment) + \epsilon\)</span></p>
<p>with <span class="math inline">\(\beta_0\)</span> being based on
country-level base-lines that are adjusted for sample means of the
independent variables. The effect <code>es</code> of a 10 % increase of
<code>log(gdp_capita)</code> on <code>lifeexpectancy</code> in years is
our main variable of interest. Like the <code>read_data()</code>
function, <code>sim_data()</code> returns a path to a temporary CSV file
containing the simulated data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">countries</span> <span class="op">=</span> <span class="fl">75</span>, <span class="va">es</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">years</span> <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">countries</span> <span class="op">*</span> <span class="va">years</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">countries</span><span class="op">)</span>, </span>
<span>                    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.ordered</a></span><span class="op">(</span><span class="op">(</span><span class="fl">2016</span> <span class="op">-</span> <span class="va">years</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">2016</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">mm_gdp_capita</span> <span class="op">&lt;-</span> <span class="fl">18000</span></span>
<span>  <span class="va">sd_gdp_capita</span> <span class="op">&lt;-</span> <span class="fl">20000</span></span>
<span>  <span class="va">location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">mm_gdp_capita</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sd_gdp_capita</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">mm_gdp_capita</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">sd_gdp_capita</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">mm_gdp_capita</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">base_gdp_capita</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">countries</span>, <span class="va">location</span>, <span class="va">shape</span><span class="op">)</span></span>
<span>  <span class="va">base_unemp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">countries</span>, <span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span></span>
<span>  <span class="va">base_mn_yrs_school</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">countries</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">base_le</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">countries</span>, <span class="fl">70</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="va">base_le</span><span class="op">[</span><span class="va">base_le</span> <span class="op">&gt;</span> <span class="fl">70</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">70</span> <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="op">(</span><span class="va">base_le</span><span class="op">[</span><span class="va">base_le</span> <span class="op">&gt;</span> <span class="fl">70</span><span class="op">]</span> <span class="op">-</span> <span class="fl">70</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">yr</span> <span class="kw">in</span> <span class="op">(</span><span class="fl">2016</span> <span class="op">-</span> <span class="va">years</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">2016</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">yr</span> <span class="op">==</span> <span class="fl">2016</span> <span class="op">-</span> <span class="va">years</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">yr</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">base_gdp_capita</span></span>
<span>    <span class="kw">else</span> <span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">yr</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">yr</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">countries</span>, <span class="fl">0</span>, <span class="fl">0.01</span> <span class="op">*</span> <span class="va">sd_gdp_capita</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">*</span></span>
<span>        <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">countries</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">mn_yrs_school</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">base_mn_yrs_school</span>, <span class="va">years</span><span class="op">)</span> <span class="op">+</span></span>
<span>                              <span class="fl">0.1</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">unemployment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">base_unemp</span>, <span class="va">years</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                            <span class="fl">0.2</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>, <span class="fl">0.0001</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">lifeexpectancy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">base_le</span>, <span class="va">years</span><span class="op">)</span> <span class="op">-</span> </span>
<span>    <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">mn_yrs_school</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">unemployment</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span></span>
<span>    <span class="op">(</span><span class="va">es</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">mn_yrs_school</span><span class="op">)</span> <span class="op">-</span>  </span>
<span>    <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">unemployment</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="va">es</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gdp_capita</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">lifeexpectancy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lifeexpectancy</span>, <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"lifeexpectancy"</span>, </span>
<span>               <span class="st">"gdp_capita"</span>, <span class="st">"mn_yrs_school"</span>, <span class="st">"unemployment"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">tfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"simdata"</span>, fileext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">tfile</span><span class="op">)</span></span>
<span>  <span class="va">tfile</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Using this code we can now test whether our design steps are able to
process the data. This tests whether based on our simulated data each
step is able to run with each feasible choice, producing output and
creating no warnings or errors.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/test_design.html">test_design</a></span><span class="op">(</span><span class="va">design</span>, input <span class="op">=</span> <span class="fu">sim_data</span><span class="op">(</span><span class="op">)</span>, reporter <span class="op">=</span> <span class="st">"minimal"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">...............................................................................................................................................................................................................................................................................................</span></span></span></code></pre></div>
<p>This looks good. Now let’s see whether the design generates an effect
estimate that is consistent with the effect of 1 year that we simulated.
For that, we pick the protocol that is consistent with the simulation,
meaning that</p>
<ul>
<li>We use the full model since <code>sim_data()</code> incorporated
effects of <code>unemployment</code> and
<code>mn_yrs_school</code>,</li>
<li>we do not treat outliers,</li>
<li>we use the level-log model specification,</li>
<li>and we include country and year fixed effects and also cluster our
standard errors by country and year.</li>
</ul>
<p>We use the function <code><a href="../reference/simulate_design_power.html">simulate_design_power()</a></code> for this
step. This function runs a provided protocol on simulated data, with
specified sample and effect size. The sample size is given in
cross-sectional units here. The function returns a data frame containing
the results for each simulation run. The density of the point estimates
allows us to assess the consistency of our design.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/simulate_design_power.html">simulate_design_power</a></span><span class="op">(</span><span class="va">design</span>, </span>
<span>                        protocol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>na_omit <span class="op">=</span> <span class="st">"no"</span>, </span>
<span>                                        idvs <span class="op">=</span> <span class="st">"full"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                          outlier_tment_style <span class="op">=</span> <span class="st">"win"</span>,</span>
<span>                                          outlier_cutoff <span class="op">=</span> <span class="fl">0</span></span>
<span>                                        <span class="op">)</span>,</span>
<span>                                        model_type <span class="op">=</span> <span class="st">"level-log"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                          fecffect <span class="op">=</span> <span class="st">"ctryyear"</span>,</span>
<span>                                          cluster <span class="op">=</span> <span class="st">"ctryyear"</span></span>
<span>                                        <span class="op">)</span><span class="op">)</span>, </span>
<span>                        input_sim_func <span class="op">=</span> <span class="va">sim_data</span>, </span>
<span>                        range_n <span class="op">=</span> <span class="fl">150</span>,</span>
<span>                        effect_size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">power_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">est</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/check_design_consist-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This looks OK. Now: How about the power? We continue to assume that a
10% increase in GDP per capita increases life expectancy by a year. How
likely is that we will be able observe this effect in the data? Let’s
see whether we have enough power to detect such an effect.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/simulate_design_power.html">simulate_design_power</a></span><span class="op">(</span><span class="va">design</span>, </span>
<span>                        protocol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>na_omit <span class="op">=</span> <span class="st">"no"</span>, </span>
<span>                                        idvs <span class="op">=</span> <span class="st">"full"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                          outlier_tment_style <span class="op">=</span> <span class="st">"win"</span>,</span>
<span>                                          outlier_cutoff <span class="op">=</span> <span class="fl">0</span></span>
<span>                                        <span class="op">)</span>,</span>
<span>                                        model_type <span class="op">=</span> <span class="st">"level-log"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                          fecffect <span class="op">=</span> <span class="st">"ctryyear"</span>,</span>
<span>                                          cluster <span class="op">=</span> <span class="st">"ctryyear"</span></span>
<span>                                        <span class="op">)</span><span class="op">)</span>, </span>
<span>                        input_sim_func <span class="op">=</span> <span class="va">sim_data</span>, </span>
<span>                        range_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                        effect_size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">power_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">est</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"lightblue"</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/check_power-1.png" width="700" style="display: block; margin: auto;"></p>
<p>As <code>n</code>, the number of cross-sectional units (countries) in
our simulation, increases, the distribution of our point estimates for
our simulated effect narrows and centers on the simulated effect size of
one year. This is good. What is the number of countries that are needed,
assuming 15 observations per country, to reach a power of <span class="math inline">\(0.8\)</span>?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lb</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"lightblue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/power_graph-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Roughly 40 countries, yielding 600 observations. The world bank data
will have more observations than that. So, power will not be an issue in
our analysis, at least not if the effect size is comparable to the one
we assumed.</p>
<p>We have now verified that our design is capable to identify a
simulated effect without bias and with sufficient power. Time to run it
on real data.</p>
</div>
<div class="section level2">
<h2 id="step-5-estimate-effect">Step 5: Estimate effect<a class="anchor" aria-label="anchor" href="#step-5-estimate-effect"></a>
</h2>
<p>As we provided weights for each design step choice, we can now
estimate the effect by applying these weights on our design. This is
done by first running <code>exhaust_design(..., weight = TRUE)</code> on
the actual data and by then using the returned protocol estimates from
this function call as input to
<code><a href="../reference/calculate_weighted_estimate.html">calculate_weighted_estimate()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weighted_ests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exhaust_design.html">exhaust_design</a></span><span class="op">(</span><span class="va">design</span>, <span class="st">"https://joachim-gassen.github.io/data/wb_new.csv"</span>,</span>
<span>                                weight <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weighted_eff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_weighted_estimate.html">calculate_weighted_estimate</a></span><span class="op">(</span><span class="va">weighted_ests</span>, <span class="st">"est"</span>, <span class="st">"lb"</span>, <span class="st">"ub"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">weighted_eff</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">est</th>
<th align="right">lb</th>
<th align="right">ub</th>
<th align="right">n</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.112</td>
<td align="right">0.029</td>
<td align="right">0.195</td>
<td align="right">12</td>
</tr></tbody>
</table>
<p>The estimated weighted effect size of 0.112 is much smaller than our
simulated effect of one year. We can also assess the results for each of
the twelve protocols with non-zero weights.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">weighted_ests</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="4%">
<col width="19%">
<col width="14%">
<col width="10%">
<col width="8%">
<col width="8%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">na.omit</th>
<th align="left">idvs</th>
<th align="left">outlier_tment_style</th>
<th align="right">outlier_cutoff</th>
<th align="left">model_type</th>
<th align="left">feffect</th>
<th align="left">cluster</th>
<th align="right">weight</th>
<th align="right">est</th>
<th align="right">lb</th>
<th align="right">ub</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">win</td>
<td align="right">0.00</td>
<td align="left">level-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.05</td>
<td align="right">0.136</td>
<td align="right">0.044</td>
<td align="right">0.228</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">trunc</td>
<td align="right">0.00</td>
<td align="left">level-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.05</td>
<td align="right">0.136</td>
<td align="right">0.044</td>
<td align="right">0.228</td>
</tr>
<tr class="odd">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">win</td>
<td align="right">0.01</td>
<td align="left">level-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.118</td>
<td align="right">0.039</td>
<td align="right">0.198</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">trunc</td>
<td align="right">0.01</td>
<td align="left">level-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.104</td>
<td align="right">0.034</td>
<td align="right">0.175</td>
</tr>
<tr class="odd">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">win</td>
<td align="right">0.05</td>
<td align="left">level-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.095</td>
<td align="right">0.022</td>
<td align="right">0.169</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">trunc</td>
<td align="right">0.05</td>
<td align="left">level-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.079</td>
<td align="right">0.005</td>
<td align="right">0.154</td>
</tr>
<tr class="odd">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">win</td>
<td align="right">0.00</td>
<td align="left">log-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.05</td>
<td align="right">0.164</td>
<td align="right">0.050</td>
<td align="right">0.277</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">trunc</td>
<td align="right">0.00</td>
<td align="left">log-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.05</td>
<td align="right">0.164</td>
<td align="right">0.050</td>
<td align="right">0.277</td>
</tr>
<tr class="odd">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">win</td>
<td align="right">0.01</td>
<td align="left">log-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.135</td>
<td align="right">0.044</td>
<td align="right">0.226</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">trunc</td>
<td align="right">0.01</td>
<td align="left">log-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.116</td>
<td align="right">0.041</td>
<td align="right">0.192</td>
</tr>
<tr class="odd">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">win</td>
<td align="right">0.05</td>
<td align="left">log-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.093</td>
<td align="right">0.010</td>
<td align="right">0.176</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="left">full</td>
<td align="left">trunc</td>
<td align="right">0.05</td>
<td align="left">log-log</td>
<td align="left">ctryyear</td>
<td align="left">ctryyear</td>
<td align="right">0.10</td>
<td align="right">0.083</td>
<td align="right">0.006</td>
<td align="right">0.161</td>
</tr>
</tbody>
</table>
<p>The protocol estimates are significant at the conventional 95 % level
for all twelve protocols. You can also run a single protocol to analyze
its full model results.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_data</span><span class="op">(</span><span class="st">"https://joachim-gassen.github.io/data/wb_new.csv"</span>, <span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">select_idvs</span><span class="op">(</span><span class="st">"full"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">treat_extreme_obs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"win"</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">specify_model</span><span class="op">(</span><span class="st">"level-log"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">est_model</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ctryyear"</span>, <span class="st">"ctryyear"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;    lfe::felm(formula = form, data = input$data) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -7.3006 -0.6092  0.0612  0.6129 10.8838 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Cluster s.e. t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; gdp_capita      1.2410       0.4051   3.063  0.00534 ** </span></span>
<span><span class="co">#&gt; mn_yrs_school   7.4985       1.2991   5.772 5.98e-06 ***</span></span>
<span><span class="co">#&gt; unemployment   -0.1483       0.3381  -0.439  0.66482    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.567 on 3798 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared(full model): 0.9751   Adjusted R-squared: 0.9738 </span></span>
<span><span class="co">#&gt; Multiple R-squared(proj model): 0.128   Adjusted R-squared: 0.08228 </span></span>
<span><span class="co">#&gt; F-statistic(full model, *iid*):748.9 on 199 and 3798 DF, p-value: &lt; 2.2e-16 </span></span>
<span><span class="co">#&gt; F-statistic(proj model): 14.47 on 3 and 24 DF, p-value: 1.373e-05</span></span></code></pre></div>
<p>Note that, while the implemented design returns an estimate of the
life expectancy effect in years of a 10 % increase in GDP per capita,
the documented model estimates of a level-log specification have to be
transformed to produce that estimate. Based on the selected model, a 10
% increase in GDP per capita would be associated with <span class="math inline">\(1.241 \log(1.1) \approx 0.118\)</span> years
change in life expectancy. Overall, one can conclude that the additional
explanatory power of our independent variables in explaining life
expectancy is modest once one allows for country and year fixed effects.
Consistent with <a href="https://doi.org/10.1111/padr.12141" class="external-link">Lutz and
Kebede (2018)</a>, we find a pronounced and significant association of
schooling with life expectancy, but due to potential reverse causality
issues I would be hesitant to argue causality here.</p>
<p>How robust is our weighted effect estimate across our documented
researcher degrees of freedom? Time to exhaust our design across all
available design choices.</p>
</div>
<div class="section level2">
<h2 id="step-6-assess-robustness-of-effect">Step 6: Assess robustness of effect<a class="anchor" aria-label="anchor" href="#step-6-assess-robustness-of-effect"></a>
</h2>
<p>We will now exhaust all design choices and estimate our effect for
each feasible protocol. As these combine to 11,264 protocols, running
the code below will take a while. This is why we load the data that is
generated by the commented lines from the disk.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ests &lt;- exhaust_design(design,</span></span>
<span><span class="co">#                        "https://joachim-gassen.github.io/data/wb_new.csv")</span></span>
<span><span class="co"># save(ests, file = "case_study_ests.RData")</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"case_study_ests.RData"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s see how the estimates distribute across our researcher degrees
of freedom.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_rdf_estimate_density.html">plot_rdf_estimate_density</a></span><span class="op">(</span><span class="va">ests</span>, <span class="st">"est"</span>, <span class="st">"lb"</span>, <span class="st">"ub"</span>, color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/estimate_density-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Quite a range of estimates. How do the coefficients vary by model
specification?<br>
For a quick overview the package has implemented the specification curve
visual as suggested by <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2694998" class="external-link">Simonsohn,
Simmons and Nelson</a>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_rdf_spec_curve.html">plot_rdf_spec_curve</a></span><span class="op">(</span><span class="va">ests</span>, <span class="st">"est"</span>, <span class="st">"lb"</span>, <span class="st">"ub"</span>, sample_frac <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> </span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/spec_curve-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This visual is based on a 10 % sample of estimates (can be adjusted
via the <code>sample_frac</code> parameter). It provides a very good
first impression of both, the overall distribution of the main estimate
of interest as well as influential choices.</p>
<p>For example, you see that the type of the estimation model is
influential for the magnitude of the effect. To be able to assess the
precise range of our estimates conditional on this discrete choice, we
now use the <code>plot_rdf_by_dchoice()</code> function with
histogram-based ridge lines instead of densities.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_rdf_ridges_by_dchoice.html">plot_rdf_ridges_by_dchoice</a></span><span class="op">(</span><span class="va">ests</span>, <span class="st">"est"</span>, <span class="st">"model_type"</span>, hist <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="fl">0.9</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/estimate_density_by_model_type-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In line with the overall shape of the Preston curve, the
specifications with untransformed (level) independent variables generate
estimates closer to zero than the ones with log-transformed independent
variables. For the following, we will concentrate on the specifications
with log-transformed independent variables that we hypothesized.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_ests</span> <span class="op">&lt;-</span> <span class="va">ests</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">model_type</span> <span class="op">==</span> <span class="st">"level-log"</span> <span class="op">|</span> <span class="va">model_type</span> <span class="op">==</span> <span class="st">"log-log"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_rdf_ridges_by_dchoice.html">plot_rdf_ridges_by_dchoice</a></span><span class="op">(</span><span class="va">log_ests</span>, <span class="st">"est"</span>, <span class="st">"feffect"</span>, hist <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="fl">0.9</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/estimate_density_by_feffect-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The influence of the applied fixed effect structure on the
coefficient of interest is striking. A set of country and year fixed
effects controls for unobserved time-invariant cross-sectional
heterogeneity and for unobserved cross-sectionally-invariant time
trends. The former can be explained by, e.g., regional determinants like
climate influencing life expectancy and the latter by developments in
medical services and other social aspects that materialize across time
and are constant across countries. As both are likely to be influential
on theoretical grounds, we limit the analysis now on protocols that
employ country and firm fixed effects and that use log-transformed
independent variables. Also, we limit the analysis to models that
estimate confidence intervals based on two-way clustered standard
errors.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rel_ests</span> <span class="op">&lt;-</span> <span class="va">log_ests</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">feffect</span> <span class="op">==</span> <span class="st">"ctryyear"</span> <span class="op">&amp;</span> </span>
<span>           <span class="va">cluster</span> <span class="op">==</span> <span class="st">"ctryyear"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_rdf_ridges_by_dchoice.html">plot_rdf_ridges_by_dchoice</a></span><span class="op">(</span><span class="va">rel_ests</span>, <span class="st">"est"</span>, <span class="st">"idvs"</span>, hist <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="fl">0.9</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/estimate_density_by_idvs-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Hmm… While most of the protocols generate an estimate roughly in the
range of 0.05 to 0.15 years, some of the univariate estimates are
smaller and even below zero. Let’s focus on them for a second and see
whether they are driven by sample selection.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rel_ests</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">idvs</span> <span class="op">==</span> <span class="st">"gdp_only"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/plot_rdf_ridges_by_dchoice.html">plot_rdf_ridges_by_dchoice</a></span><span class="op">(</span><span class="st">"est"</span>, <span class="st">"na.omit"</span>, hist <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="fl">0.9</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/estimate_density_by_idvs_na-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Yes, this seems to be the case. When assessed univariately on the
largest possible sample, the range of estimates becomes considerably
larger. Is this driven by extreme observations?</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rel_ests</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">idvs</span> <span class="op">==</span> <span class="st">"gdp_only"</span>,</span>
<span>         <span class="va">na.omit</span> <span class="op">==</span> <span class="st">"no"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_rdf_estimates_by_choice.html">plot_rdf_estimates_by_choice</a></span><span class="op">(</span><span class="st">"est"</span>, <span class="st">"lb"</span>, <span class="st">"ub"</span>, <span class="st">"outlier_tment_style"</span>, </span>
<span>                               color <span class="op">=</span> <span class="st">"model_type"</span>, order <span class="op">=</span> <span class="st">"outlier_cutoff"</span>, width <span class="op">=</span> <span class="fl">0.008</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/estimates_gdp_only_by_outlier-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This seems to be the case. In general, the stricter the outlier
treatment, the larger the estimate. In addition, the univariate
level-log specifications are generating larger and slightly narrower
estimates compared to the univariate log-log specification, consistent
with a percentage increase in GDP rather being associated with an
absolute increase in life expectancy than a relative one. This seems
reasonable because of diminishing rates of returns to wealth.</p>
<p>Our last test will focus on the multivariate analyses that just use
schooling as additional control, since including unemployment reduces
the sample size while contributing little to the explanatory power of
the model.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rel_ests</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">na.omit</span> <span class="op">==</span> <span class="st">"no"</span>,</span>
<span>         <span class="va">idvs</span> <span class="op">==</span> <span class="st">"gdp_school"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/plot_rdf_estimates_by_choice.html">plot_rdf_estimates_by_choice</a></span><span class="op">(</span><span class="st">"est"</span>, <span class="st">"lb"</span>, <span class="st">"ub"</span>, <span class="st">"outlier_tment_style"</span>, </span>
<span>                               color <span class="op">=</span> <span class="st">"model_type"</span>, order <span class="op">=</span> <span class="st">"outlier_cutoff"</span>, width <span class="op">=</span> <span class="fl">0.008</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_rdf_files/figure-html/estimates_gdp_school_by_outlier-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Again, outliers turn out to be influential here but into the opposite
direction. Focusing on the narrower estimates of the level-log
specification, it becomes apparent that removing outliers by truncating
renders the estimate smaller and insignificant, while winsorizing
extreme values does little to the coefficient.</p>
</div>
<div class="section level2">
<h2 id="summing-up">Summing up<a class="anchor" aria-label="anchor" href="#summing-up"></a>
</h2>
<p>Using the <code>rdfanalysis</code> package, we are able to
systematically explore the 11,264 degrees of freedom that we identified
in a supposedly straight-forward panel data analysis of observational
data.</p>
<p>Allowing for time-invariant country-level unobservables and
country-invariant unobservables affecting the time-series and
controlling for unemployment and years of schooling, we estimate the
effect of a 10 % increase of GDP per capita on life expectancy to be in
the area of 0.03 to 0.2 years. Assuming that no other unobservables or
reverse causality issues affect our findings, this coefficient could be
interpreted as causal, but given how courageous these assumptions are I
strongly advise against it.</p>
<p>As can be assessed by the researcher degrees of freedom exploration,
our estimate is only one of many feasible estimates. The total range of
estimates spans from a lower bound of -0.35 to an upper bound of 0.92
years. Three observations stand out from the exploration:</p>
<ul>
<li>The country-year fixed effect structure has a large dampening effect
on the estimates.</li>
<li>Using log-transformed values for the independent variables generally
increases the estimates.</li>
<li>The implicit sample selection caused by including additional control
variables is also influential for our estimate and tends to increase
it.</li>
</ul>
<p>It is impressive to see the number of researcher degrees of freedom
that even such a simple research design like the one at hand implies. My
hope is that the <code>rdfanalysis</code> package might motivate
researchers to think more deeply about their choice set and to explore
and document their findings more transparently.</p>
<p>If you have remarks about this vignette or the package, I would love
to hear from you. Feel free to reach out via <a href="mailto:gassen@wiwi.hu-berlin.de">email</a> or <a href="https://twitter.com/JoachimGassen" class="external-link">twitter</a>.</p>
<p>Enjoy!</p>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<p>Below you find the code to run the data in the ExPanD shiny web app
for extensive interactive exploration. You can re-generate most
protocols from above and more. An online version is accessible <a href="https://jgassen.shinyapps.io/expand_rdfanalysis" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joachim-gassen.github.io/ExPanDaR/" class="external-link">ExPanDaR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://joachim-gassen.github.io/data/wb_new.csv"</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lifeexpectancy"</span>, <span class="st">"gdp_capita"</span>,</span>
<span>           <span class="st">"mn_yrs_school"</span>, <span class="st">"unemployment"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ln <span class="op">=</span> <span class="va">log</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">region</span>, <span class="va">year</span>, </span>
<span>         <span class="va">gdp_capita</span>, <span class="va">lifeexpectancy</span>,</span>
<span>         <span class="va">mn_yrs_school</span>, <span class="va">unemployment</span>,</span>
<span>         <span class="va">gdp_capita_ln</span>, <span class="va">lifeexpectancy_ln</span>, </span>
<span>         <span class="va">mn_yrs_school_ln</span>, <span class="va">unemployment_ln</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">df_na.omit</span> <span class="op">&lt;-</span> <span class="va">df_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">na.omit</span></span>
<span></span>
<span><span class="va">wb_var_def</span> <span class="op">&lt;-</span> <span class="va">worldbank_var_def</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span>,<span class="fl">23</span>,<span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">worldbank_data_def</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var_def"</span> <span class="op">=</span> <span class="st">"var_name"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">var_def</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>var_def <span class="op">=</span> <span class="va">var_def.y</span>,</span>
<span>         type <span class="op">=</span> <span class="va">type.x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">var_name</span>, <span class="va">var_def</span>, <span class="va">type</span>, <span class="va">can_be_na</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span>var_name <span class="op">=</span> <span class="st">"mn_yrs_school"</span>, var_def <span class="op">=</span> <span class="st">"Mean number of years spent in school, age group 15+. Source: Wittgenstein Centre for Demography and Global Human Capital (2018). Wittgenstein Centre Data Explorer Version 2.0. Data between five year intervals are based on linear interpolation."</span>, </span>
<span>          type <span class="op">=</span> <span class="st">"numeric"</span>, can_be_na <span class="op">=</span> <span class="fl">1</span>, .after <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gdp_capita"</span>, <span class="st">"lifeexpectancy"</span>, <span class="st">"mn_yrs_school"</span>, <span class="st">"unemployment"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">wb_var_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">wb_var_def</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">var</span>, <span class="st">"_ln"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Log-transformed version of"</span>, <span class="va">var</span><span class="op">)</span>, <span class="st">"numeric"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">abstract</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;This interactive display is part of the "</span>,</span>
<span>                  <span class="st">"&lt;a href=https://joachim-gassen.github.io/rdfanalysis&gt;"</span>,</span>
<span>                  <span class="st">"R package rdfanalysis&lt;/a&gt;."</span>,</span>
<span>                  <span class="st">"The package provides researchers with a coding framework"</span>,</span>
<span>                  <span class="st">"that supports formal documentation and systematic"</span>,</span>
<span>                  <span class="st">"exploration of the researcher degrees of freedom that are"</span>,</span>
<span>                  <span class="st">"inherent in research designs.&lt;/p&gt;"</span>,</span>
<span>                  <span class="st">"&lt;p&gt;Data is provided by the World Bank and the Wittgenstein"</span>,</span>
<span>                  <span class="st">"Centre and used to assess the impact of real"</span>,</span>
<span>                  <span class="st">"gross domestic product (GDP) per capita on life expectancy."</span>,</span>
<span>                  <span class="st">"This association has become known as the Preston Curve.&lt;p&gt;"</span>,</span>
<span>                  <span class="st">"You can choose below whether you want to examine a sample"</span>,</span>
<span>                  <span class="st">"with or without missing observations. Hover over the"</span>,</span>
<span>                  <span class="st">"variable names in the descriptive table to see variable"</span>,</span>
<span>                  <span class="st">"definitions and use the various displays to explore the"</span>, </span>
<span>                  <span class="st">"data.&lt;p&gt;"</span>,</span>
<span>                  <span class="st">"Joachim Gassen - &lt;a href=mailto:gassen@wiwi.hu-berlin.de&gt;"</span>,</span>
<span>                  <span class="st">"gassen@wiwi.hu-berlin.de&lt;/a&gt; - March 2019"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://joachim-gassen.github.io/ExPanDaR/reference/ExPanD.html" class="external-link">ExPanD</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">df_all</span>, <span class="va">df_na.omit</span><span class="op">)</span>, </span>
<span>       df_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All observations"</span>, <span class="st">"Observations with NAs omitted"</span><span class="op">)</span>,</span>
<span>       df_def <span class="op">=</span> <span class="va">wb_var_def</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Explore the Link Between National Income and Life Expectancy (Preston Curve)"</span>,</span>
<span>       abstract <span class="op">=</span> <span class="va">abstract</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joachim Gassen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
